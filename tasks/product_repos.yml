---
- name: set fact to enable all repos to yes or no
  set_fact:
    all_repos: "{{ 'yes' if 'omit' in product_reposets else 'no' }}"

- name: enable Red Hat product repository
  block:
    - name: enabling product {{ product_label }}
      redhat.satellite.repository_set:
        username: "{{ org_user_admin }}"
        password: "{{ org_user_pass }}"
        server_url: "{{ satellite_url }}"
        validate_certs: "{{ satellite_verify_ssl }}"
        organization: "{{ product_org }}"
        label: "{{ product_label }}"
        repositories: "{{ product_reposets | default(omit) }}"
        all_repositories: "{{ all_repos }}"
        state: "{{ product_state }}"
      register: products_enabled
  rescue:
    - debug:
        msg: "Could not enable {{ product_label }} repository"
  tags: [katello,repo]
